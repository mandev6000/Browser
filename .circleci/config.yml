# # Use the latest 2.1 version of CircleCI pipeline process engine. See: https://circleci.com/docs/2.0/configuration-reference
# version: 2.1
# jobs:
#   node:
#     working_directory: ~/Browser
#     docker:
#       - image: circleci/node:10.16.0
#     steps:
#       - checkout

#       - restore_cache:
#           key: yarn-v1-{{ checksum "yarn.lock" }}-{{ arch }}

#       - restore_cache:
#           key: node-v1-{{ checksum "package.json" }}-{{ arch }}

#       - run: yarn install

#       - save_cache:
#           key: yarn-v1-{{ checksum "yarn.lock" }}-{{ arch }}
#           paths:
#             - ~/.cache/yarn

#       - save_cache:
#           key: node-v1-{{ checksum "package.json" }}-{{ arch }}
#           paths:
#             - node_modules

#       - run:
#           name: jest tests
#           command: |
#             mkdir -p test-results/jest
#             yarn run test
#           environment:
#             JEST_JUNIT_OUTPUT: test-results/jest/junit.xml
#       - sonarcloud/scan

#       - persist_to_workspace:
#           root: ~/Browser
#           paths:
#             - node_modules

#       - store_test_results:
#           path: test-results

#       - store_artifacts:
#           path: test-results

# orbs:
#   sonarcloud: sonarsource/sonarcloud@1.0.1

# workflows:
#   version: 2
#   node-android-ios:
#     jobs:
#       - node:
#           context: SonarCloud



version: 2.1

jobs:
  build:
    docker:
      - image: circleci/node:10.16.0
    steps:
      - checkout

      - restore_cache:
          key: node-v1-{{ checksum "package.json" }}-{{ arch }}

      - run: npm install

      - save_cache:
          key: node-v1-{{ checksum "package.json" }}-{{ arch }}
          paths:
            - node_modules

      - run:
          name: jest tests
          command: |
            mkdir -p test-results/jest
            npm test
          environment:
            JEST_JUNIT_OUTPUT: test-results/jest/junit.xml

      - sonarcloud/scan

orbs:
  sonarcloud: sonarsource/sonarcloud@1.0.1

workflows:
  main:
    jobs:
      - build:
          context: SonarQube
